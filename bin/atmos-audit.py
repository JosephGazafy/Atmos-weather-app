#!/usr/bin/env python3
import time, os, hashlib

LOG_FILE = "sovereign_log.txt"
AUDIT_DIR = "audits"

def generate_sovereign_signature(content):
    # Create a SHA-256 hash of the report content
    return hashlib.sha256(content.encode()).hexdigest()

def generate_report():
    today = time.strftime("%Y-%m-%d")
    report_path = os.path.join(AUDIT_DIR, f"sovereign_audit_{today}.md")
    
    lockdowns = 0
    intercepts = 0
    maxim_list = []

    if os.path.exists(LOG_FILE):
        with open(LOG_FILE, "r") as f:
            for line in f:
                if today in line:
                    if "[LOCKDOWN]" in line: lockdowns += 1
                    if "[RHYTHM]" in line or "[INTERCEPT]" in line:
                        intercepts += 1
                        if "Maxim:" in line:
                            maxim_list.append(line.split("Maxim:")[-1].strip())

    # Build the report content
    content = f"# üèõÔ∏è SOVEREIGN AUDIT REPORT | {today}\n\n"
    content += f"## üìä SYSTEM METRICS\n"
    content += f"- **TOTAL INTERCEPTS:** {intercepts}\n"
    content += f"- **LOCKDOWN EVENTS:** {lockdowns}\n"
    content += f"- **NODE LOCATION:** Independence, MO\n\n"
    content += f"## üìú MAXIM INJECTION LOG (SAMPLE)\n"
    for m in maxim_list[-10:]:
        content += f"- *\"{m}\"*\n"
    
    # Generate the signature
    signature = generate_sovereign_signature(content)
    
    content += f"\n---\n"
    content += f"### üîê CRYPTOGRAPHIC INTEGRITY\n"
    content += f"- **SHA-256 SIGNATURE:** `{signature}`\n"
    content += f"- **STATUS:** VERIFIED IMMUTABLE\n\n"
    content += f"*Generated by Atmos-Atlas v13.2*"

    with open(report_path, "w") as r:
        r.write(content)
    
    # Log the signature for the hyperlattice
    with open(LOG_FILE, "a") as f:
        f.write(f"üîí [INTEGRITY] Audit signed for {today} | Hash: {signature[:12]}...\n")
    
    print(f"‚úÖ [AUDIT] signed report generated: {report_path}")

if __name__ == "__main__":
    generate_report()
